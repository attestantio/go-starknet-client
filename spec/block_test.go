// Copyright Â© 2024 Attestant Limited.
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package spec_test

import (
	"encoding/json"
	"testing"

	"github.com/attestantio/go-starknet-client/spec"
	"github.com/stretchr/testify/require"
)

func TestBlock(t *testing.T) {
	tests := []struct {
		name     string
		input    []byte
		expected []byte
		err      string
	}{
		{
			name: "Empty",
			err:  "unexpected end of JSON input",
		},
		{
			name:  "JSONBad",
			input: []byte("[]"),
			err:   "json: cannot unmarshal array into Go value of type spec.Block",
		},
		{
			name:  "Full",
			input: []byte(`{"status":"ACCEPTED_ON_L1","block_hash":"0x5c627d4aeb51280058bed93c7889bce78114d63baad1be0f0aeb32496d5f19c","parent_hash":"0x0","block_number":0,"new_root":"0xe005205a1327f3dff98074e528f7b96f30e0624a1dfcf571bdc81948d150a0","timestamp":1700406220,"sequencer_address":"0x1176a1bd84444c89232ec27754698e5d2e7e1a7f1539f12027f28b23ec9f3d8","l1_gas_price":{"price_in_fri":"0x0","price_in_wei":"0x3e617dc5"},"l1_data_gas_price":{"price_in_fri":"0x1","price_in_wei":"0x1"},"l1_da_mode":"CALLDATA","starknet_version":"0.12.3","transactions":[{"transaction":{"transaction_hash":"0x656e113cb27707d2147c271a79c51d1069b0273ae447b965e15154a17b3ec01","type":"DECLARE","version":"0x0","max_fee":"0x0","class_hash":"0x5c478ee27f2112411f86f207605b2e2c58cdb647bac0df27f660ef2252359c6","sender_address":"0x1","signature":[]},"receipt":{"type":"DECLARE","transaction_hash":"0x656e113cb27707d2147c271a79c51d1069b0273ae447b965e15154a17b3ec01","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":2711,"pedersen_builtin_applications":15,"range_check_builtin_applications":63,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x32538718071ad83ccd09fca03fe3a17add776ec12002d1c4e16ad4b92ddf752","type":"DECLARE","version":"0x0","max_fee":"0x0","class_hash":"0xd0e183745e9dae3e4e78a8ffedcce0903fc4900beace4e0abf192d4c202da3","sender_address":"0x1","signature":[]},"receipt":{"type":"DECLARE","transaction_hash":"0x32538718071ad83ccd09fca03fe3a17add776ec12002d1c4e16ad4b92ddf752","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":2711,"pedersen_builtin_applications":15,"range_check_builtin_applications":63,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x144f41e654d0916810a83df0fe8984043671200f28df1206f58566144e302dd","type":"DEPLOY_ACCOUNT","version":"0x1","nonce":"0x0","max_fee":"0x0","contract_address_salt":"0x0","class_hash":"0x5c478ee27f2112411f86f207605b2e2c58cdb647bac0df27f660ef2252359c6","constructor_calldata":["0x12c4df40394d06f157edec8d0e64db61fe0c271149ea860c8fe98def29ecf02"],"signature":["0x13f82fd9238dfc8d01543f89be2b5d5589b3eb93d9c3b888f1f94b089768771","0x2c279ec310c4dd58a296fab66b2624640780e79a1c5c87388e6150fb5384a9d"]},"receipt":{"type":"DEPLOY_ACCOUNT","transaction_hash":"0x144f41e654d0916810a83df0fe8984043671200f28df1206f58566144e302dd","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"contract_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","execution_resources":{"steps":3863,"pedersen_builtin_applications":23,"range_check_builtin_applications":83,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x6a5a493cf33919e58aa4c75777bffdef97c0e39cac968896d7bee8cc67905a1","type":"INVOKE","version":"0x1","nonce":"0x1","max_fee":"0x0","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","signature":["0x357dbb6c509a7d4b58f8ee7151236278b7959b39f7d05b8f7e2ef20593bdf7e","0x64d5f748eef19ca7f1c8cc533e5c9c85f80ef4f040c75da67bda82f5c58328d"],"calldata":["0x1","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x2730079d734ee55315f4f141eaed376bddd8c2133523d223a344c5604e0f7f8","0x0","0x5","0x5","0xd0e183745e9dae3e4e78a8ffedcce0903fc4900beace4e0abf192d4c202da3","0x322c2610264639f6b2cee681ac53fa65c37e187ea24292d1b21d859c55e1a78","0x1","0x0","0x1"]},"receipt":{"type":"INVOKE","transaction_hash":"0x6a5a493cf33919e58aa4c75777bffdef97c0e39cac968896d7bee8cc67905a1","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":5617,"pedersen_builtin_applications":23,"range_check_builtin_applications":122,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x4a5a3a951244f37c97b258465db17ba235dc68fd369c539d763bae99b2cae1","type":"INVOKE","version":"0x1","nonce":"0x2","max_fee":"0x0","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","signature":["0x6b5baf01bf27386f1544efcf2e91aa69a42a41a9781e24b3cd984a91e815de7","0x2de46894d2f386d25f2258e80f464e05f08daab78df764d87c4381a7eae6c97"],"calldata":["0x1","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x2730079d734ee55315f4f141eaed376bddd8c2133523d223a344c5604e0f7f8","0x0","0x5","0x5","0xd0e183745e9dae3e4e78a8ffedcce0903fc4900beace4e0abf192d4c202da3","0x322c2610264639f6b2cee681ac53fa65c37e187ea24292d1b21d859c55e1a78","0x1","0x0","0x0"]},"receipt":{"type":"INVOKE","transaction_hash":"0x4a5a3a951244f37c97b258465db17ba235dc68fd369c539d763bae99b2cae1","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":5617,"pedersen_builtin_applications":23,"range_check_builtin_applications":122,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x1bec64a9f5ff52154b560fd489ae2aabbfcb31062f7ea70c3c674ddf14b0add","type":"INVOKE","version":"0x1","nonce":"0x3","max_fee":"0x0","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","signature":["0x44580ba3cd68e5d9509d2fcb8bd09933ae4a7b7dfe6744eaa2329f9a79d7408","0x68404a4da22c31d8367f873c043318750a24c669702c72de8518a3d52284b94"],"calldata":["0x1","0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7","0x195d4289b867c3d98c335ea31402667f3592e227faf3d2991308563ed102aab","0x0","0x0","0x0"]},"receipt":{"type":"INVOKE","transaction_hash":"0x1bec64a9f5ff52154b560fd489ae2aabbfcb31062f7ea70c3c674ddf14b0add","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[{"from_address":"0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7","keys":["0x3774b0545aabb37c45c1eddc6a7dae57de498aae6d5e3589e362d4b4323a533"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]},{"from_address":"0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7","keys":["0x4595132f9b33b7077ebf2e7f3eb746a8e0a6d5c337c71cd8f9bf46cac3cfd7"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]}],"execution_resources":{"steps":4854,"pedersen_builtin_applications":17,"range_check_builtin_applications":106,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x72b2d3b79b3da51efe860da954a2f50d23da95f028a456c5356a08e61642754","type":"INVOKE","version":"0x1","nonce":"0x4","max_fee":"0x0","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","signature":["0x12ef79a31ed2ff357b290f40c8c1bbe53cbb253866f0dc52b25aabbfb443c2b","0x376b2ddfd1ba9c6a0d72e3e4dbc5bbb1f0d2601089999cbf477aed944ae5c03"],"calldata":["0x1","0x4c5772d1914fe6ce891b64eb35bf3522aeae1315647314aac58b01137607f3f","0x195d4289b867c3d98c335ea31402667f3592e227faf3d2991308563ed102aab","0x0","0x0","0x0"]},"receipt":{"type":"INVOKE","transaction_hash":"0x72b2d3b79b3da51efe860da954a2f50d23da95f028a456c5356a08e61642754","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[{"from_address":"0x4c5772d1914fe6ce891b64eb35bf3522aeae1315647314aac58b01137607f3f","keys":["0x3774b0545aabb37c45c1eddc6a7dae57de498aae6d5e3589e362d4b4323a533"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]},{"from_address":"0x4c5772d1914fe6ce891b64eb35bf3522aeae1315647314aac58b01137607f3f","keys":["0x4595132f9b33b7077ebf2e7f3eb746a8e0a6d5c337c71cd8f9bf46cac3cfd7"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]}],"execution_resources":{"steps":4854,"pedersen_builtin_applications":17,"range_check_builtin_applications":106,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}}]}`),
			// Ordering is different.
			expected: []byte(`{"status":"ACCEPTED_ON_L1","block_hash":"0x5c627d4aeb51280058bed93c7889bce78114d63baad1be0f0aeb32496d5f19c","parent_hash":"0x0","block_number":0,"new_root":"0xe005205a1327f3dff98074e528f7b96f30e0624a1dfcf571bdc81948d150a0","timestamp":1700406220,"sequencer_address":"0x1176a1bd84444c89232ec27754698e5d2e7e1a7f1539f12027f28b23ec9f3d8","l1_gas_price":{"price_in_fri":"0x0","price_in_wei":"0x3e617dc5"},"l1_data_gas_price":{"price_in_fri":"0x1","price_in_wei":"0x1"},"l1_da_mode":"CALLDATA","starknet_version":"0.12.3","transactions":[{"transaction":{"transaction_hash":"0x656e113cb27707d2147c271a79c51d1069b0273ae447b965e15154a17b3ec01","type":"DECLARE","sender_address":"0x1","max_fee":"0x0","version":"0x0","signature":[],"class_hash":"0x5c478ee27f2112411f86f207605b2e2c58cdb647bac0df27f660ef2252359c6"},"receipt":{"type":"DECLARE","transaction_hash":"0x656e113cb27707d2147c271a79c51d1069b0273ae447b965e15154a17b3ec01","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":2711,"pedersen_builtin_applications":15,"range_check_builtin_applications":63,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x32538718071ad83ccd09fca03fe3a17add776ec12002d1c4e16ad4b92ddf752","type":"DECLARE","sender_address":"0x1","max_fee":"0x0","version":"0x0","signature":[],"class_hash":"0xd0e183745e9dae3e4e78a8ffedcce0903fc4900beace4e0abf192d4c202da3"},"receipt":{"type":"DECLARE","transaction_hash":"0x32538718071ad83ccd09fca03fe3a17add776ec12002d1c4e16ad4b92ddf752","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":2711,"pedersen_builtin_applications":15,"range_check_builtin_applications":63,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x144f41e654d0916810a83df0fe8984043671200f28df1206f58566144e302dd","type":"DEPLOY_ACCOUNT","max_fee":"0x0","version":"0x1","signature":["0x13f82fd9238dfc8d01543f89be2b5d5589b3eb93d9c3b888f1f94b089768771","0x2c279ec310c4dd58a296fab66b2624640780e79a1c5c87388e6150fb5384a9d"],"nonce":"0x0","contract_address_salt":"0x0","constructor_calldata":["0x12c4df40394d06f157edec8d0e64db61fe0c271149ea860c8fe98def29ecf02"],"class_hash":"0x5c478ee27f2112411f86f207605b2e2c58cdb647bac0df27f660ef2252359c6"},"receipt":{"type":"DEPLOY_ACCOUNT","transaction_hash":"0x144f41e654d0916810a83df0fe8984043671200f28df1206f58566144e302dd","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"contract_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","execution_resources":{"steps":3863,"pedersen_builtin_applications":23,"range_check_builtin_applications":83,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x6a5a493cf33919e58aa4c75777bffdef97c0e39cac968896d7bee8cc67905a1","type":"INVOKE","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","calldata":["0x1","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x2730079d734ee55315f4f141eaed376bddd8c2133523d223a344c5604e0f7f8","0x0","0x5","0x5","0xd0e183745e9dae3e4e78a8ffedcce0903fc4900beace4e0abf192d4c202da3","0x322c2610264639f6b2cee681ac53fa65c37e187ea24292d1b21d859c55e1a78","0x1","0x0","0x1"],"max_fee":"0x0","version":"0x1","signature":["0x357dbb6c509a7d4b58f8ee7151236278b7959b39f7d05b8f7e2ef20593bdf7e","0x64d5f748eef19ca7f1c8cc533e5c9c85f80ef4f040c75da67bda82f5c58328d"],"nonce":"0x1"},"receipt":{"type":"INVOKE","transaction_hash":"0x6a5a493cf33919e58aa4c75777bffdef97c0e39cac968896d7bee8cc67905a1","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":5617,"pedersen_builtin_applications":23,"range_check_builtin_applications":122,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x4a5a3a951244f37c97b258465db17ba235dc68fd369c539d763bae99b2cae1","type":"INVOKE","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","calldata":["0x1","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x2730079d734ee55315f4f141eaed376bddd8c2133523d223a344c5604e0f7f8","0x0","0x5","0x5","0xd0e183745e9dae3e4e78a8ffedcce0903fc4900beace4e0abf192d4c202da3","0x322c2610264639f6b2cee681ac53fa65c37e187ea24292d1b21d859c55e1a78","0x1","0x0","0x0"],"max_fee":"0x0","version":"0x1","signature":["0x6b5baf01bf27386f1544efcf2e91aa69a42a41a9781e24b3cd984a91e815de7","0x2de46894d2f386d25f2258e80f464e05f08daab78df764d87c4381a7eae6c97"],"nonce":"0x2"},"receipt":{"type":"INVOKE","transaction_hash":"0x4a5a3a951244f37c97b258465db17ba235dc68fd369c539d763bae99b2cae1","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[],"execution_resources":{"steps":5617,"pedersen_builtin_applications":23,"range_check_builtin_applications":122,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x1bec64a9f5ff52154b560fd489ae2aabbfcb31062f7ea70c3c674ddf14b0add","type":"INVOKE","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","calldata":["0x1","0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7","0x195d4289b867c3d98c335ea31402667f3592e227faf3d2991308563ed102aab","0x0","0x0","0x0"],"max_fee":"0x0","version":"0x1","signature":["0x44580ba3cd68e5d9509d2fcb8bd09933ae4a7b7dfe6744eaa2329f9a79d7408","0x68404a4da22c31d8367f873c043318750a24c669702c72de8518a3d52284b94"],"nonce":"0x3"},"receipt":{"type":"INVOKE","transaction_hash":"0x1bec64a9f5ff52154b560fd489ae2aabbfcb31062f7ea70c3c674ddf14b0add","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[{"from_address":"0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7","keys":["0x3774b0545aabb37c45c1eddc6a7dae57de498aae6d5e3589e362d4b4323a533"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]},{"from_address":"0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7","keys":["0x4595132f9b33b7077ebf2e7f3eb746a8e0a6d5c337c71cd8f9bf46cac3cfd7"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]}],"execution_resources":{"steps":4854,"pedersen_builtin_applications":17,"range_check_builtin_applications":106,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}},{"transaction":{"transaction_hash":"0x72b2d3b79b3da51efe860da954a2f50d23da95f028a456c5356a08e61642754","type":"INVOKE","sender_address":"0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","calldata":["0x1","0x4c5772d1914fe6ce891b64eb35bf3522aeae1315647314aac58b01137607f3f","0x195d4289b867c3d98c335ea31402667f3592e227faf3d2991308563ed102aab","0x0","0x0","0x0"],"max_fee":"0x0","version":"0x1","signature":["0x12ef79a31ed2ff357b290f40c8c1bbe53cbb253866f0dc52b25aabbfb443c2b","0x376b2ddfd1ba9c6a0d72e3e4dbc5bbb1f0d2601089999cbf477aed944ae5c03"],"nonce":"0x4"},"receipt":{"type":"INVOKE","transaction_hash":"0x72b2d3b79b3da51efe860da954a2f50d23da95f028a456c5356a08e61642754","actual_fee":{"amount":"0x0","unit":"WEI"},"execution_status":"SUCCEEDED","finality_status":"ACCEPTED_ON_L1","messages_sent":[],"events":[{"from_address":"0x4c5772d1914fe6ce891b64eb35bf3522aeae1315647314aac58b01137607f3f","keys":["0x3774b0545aabb37c45c1eddc6a7dae57de498aae6d5e3589e362d4b4323a533"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8","0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]},{"from_address":"0x4c5772d1914fe6ce891b64eb35bf3522aeae1315647314aac58b01137607f3f","keys":["0x4595132f9b33b7077ebf2e7f3eb746a8e0a6d5c337c71cd8f9bf46cac3cfd7"],"data":["0x43abaa073c768ebf039c0c4f46db9acc39e9ec165690418060a652aab39e7d8"]}],"execution_resources":{"steps":4854,"pedersen_builtin_applications":17,"range_check_builtin_applications":106,"ecdsa_builtin_applications":1,"data_availability":{"l1_gas":0,"l1_data_gas":0}}}}]}`),
		},
	}

	for _, test := range tests {
		t.Run(test.name, func(t *testing.T) {
			var res spec.Block
			err := json.Unmarshal(test.input, &res)
			if test.err != "" {
				require.EqualError(t, err, test.err)
			} else {
				require.NoError(t, err)
				rt, err := json.Marshal(&res)
				require.NoError(t, err)
				if len(test.expected) == 0 {
					require.Equal(t, string(test.input), string(rt))
				} else {
					require.Equal(t, string(test.expected), string(rt))
				}
			}
		})
	}
}
